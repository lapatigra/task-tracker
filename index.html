<!DOCTYPE html>

<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-title" content="–¢—Ä–µ–∫–µ—Ä">
    <title>–¢—Ä–µ–∫–µ—Ä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

    html {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d1810 100%);
        min-height: 100vh;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: linear-gradient(135deg, #1a1a1a 0%, #2d1810 100%);
        min-height: 100vh;
        padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        color: #e0e0e0;
    }

    .container {
        max-width: 100%;
        margin: 0 auto;
        padding: 10px;
        background: linear-gradient(135deg, #1a1a1a 0%, #2d1810 100%);
        min-height: 100vh;
    }

    .header {
        background: rgba(30, 30, 30, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 107, 53, 0.2);
    }

    .header h1 {
        font-size: 24px;
        font-weight: 700;
        color: #ff9a56;
        margin-bottom: 10px;
        text-align: center;
    }

    .month-selector {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        margin-top: 15px;
    }

    .month-btn {
        background: #ff6b35;
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
    }

    .month-btn:active {
        transform: scale(0.95);
        background: #ff5722;
    }

    .current-month {
        font-size: 20px;
        font-weight: 600;
        color: #ff9a56;
        min-width: 150px;
        text-align: center;
    }

    .tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 15px;
    }

    .tab {
        flex: 1;
        background: rgba(30, 30, 30, 0.9);
        border: none;
        padding: 10px 8px;
        border-radius: 15px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        color: #999;
    }

    .tab.active {
        background: rgba(40, 40, 40, 0.95);
        color: #ff9a56;
        box-shadow: 0 4px 12px rgba(255, 154, 86, 0.3);
        border: 1px solid rgba(255, 154, 86, 0.3);
    }

    .content-section {
        display: none;
    }

    .content-section.active {
        display: block;
    }

    .tasks-grid {
        background: rgba(30, 30, 30, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 107, 53, 0.1);
    }

    .task-category {
        margin-bottom: 10px;
    }

    .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: linear-gradient(135deg, #ff9a56 0%, #ff6b35 100%);
        border-radius: 12px;
        margin-bottom: 10px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        user-select: none;
        transition: all 0.3s;
    }

    .category-header:active {
        transform: scale(0.98);
    }

    .category-name {
        font-size: 16px;
    }

    .category-toggle {
        font-size: 18px;
        transition: transform 0.3s;
        margin-left: 10px;
    }

    .category-toggle.collapsed {
        transform: rotate(-90deg);
    }

    .category-content {
        max-height: 2000px;
        overflow: hidden;
        transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
        opacity: 1;
    }

    .category-content.collapsed {
        max-height: 0;
        opacity: 0;
    }

    .category-count {
        background: rgba(255, 255, 255, 0.3);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
    }

    .week-container {
        margin-bottom: 15px;
    }

    .week-header {
        font-size: 12px;
        color: #999;
        margin-bottom: 8px;
        padding-left: 5px;
        font-weight: 600;
    }

    .days-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
    }

    .day-cell {
        aspect-ratio: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #2a2a2a;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
    }

    .day-label {
        font-size: 10px;
        color: #999;
        margin-bottom: 2px;
    }

    .day-checkbox {
        width: 20px;
        height: 20px;
        appearance: none;
        border: 2px solid #444;
        border-radius: 6px;
        cursor: pointer;
        position: relative;
        transition: all 0.2s;
        background: #1a1a1a;
    }

    .day-checkbox:checked {
        background: linear-gradient(135deg, #ff9a56 0%, #ff6b35 100%);
        border-color: #ff6b35;
    }

    .day-checkbox:checked::after {
        content: '‚úì';
        position: absolute;
        color: white;
        font-size: 14px;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .stats-container {
        background: rgba(30, 30, 30, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 107, 53, 0.1);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 20px;
    }

    .stat-card {
        background: linear-gradient(135deg, #ff9a56 0%, #ff6b35 100%);
        padding: 15px;
        border-radius: 15px;
        color: white;
    }

    .stat-label {
        font-size: 12px;
        opacity: 0.9;
        margin-bottom: 5px;
    }

    .stat-value {
        font-size: 28px;
        font-weight: 700;
    }

    .chart-container {
        margin-top: 20px;
        background: #2a2a2a;
        padding: 15px;
        border-radius: 15px;
    }

    .chart-title {
        font-size: 16px;
        font-weight: 600;
        color: #ff9a56;
        margin-bottom: 15px;
        text-align: center;
    }

    .bar-chart {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .bar-item {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .bar-label {
        min-width: 100px;
        font-size: 14px;
        color: #ccc;
    }

    .bar-track {
        flex: 1;
        height: 30px;
        background: #1a1a1a;
        border-radius: 15px;
        position: relative;
        overflow: hidden;
    }

    .bar-fill {
        height: 100%;
        background: linear-gradient(135deg, #ff9a56 0%, #ff6b35 100%);
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 10px;
        color: white;
        font-size: 12px;
        font-weight: 600;
        transition: width 0.5s ease;
    }

    .summary-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: #2a2a2a;
        border-radius: 12px;
    }

    .summary-category {
        font-weight: 600;
        color: #e0e0e0;
    }

    .summary-stats {
        display: flex;
        gap: 15px;
        font-size: 14px;
    }

    .summary-stat {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .summary-stat-label {
        font-size: 11px;
        color: #999;
    }

    .summary-stat-value {
        font-weight: 700;
        color: #ff9a56;
    }

    .muscle-tracker {
        background: rgba(30, 30, 30, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 107, 53, 0.1);
    }

    .muscle-grid {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 15px;
    }

    .muscle-item {
        background: #2a2a2a;
        padding: 10px 15px;
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.2s;
    }

    .muscle-item.completed {
        background: linear-gradient(135deg, rgba(255, 154, 86, 0.2) 0%, rgba(255, 107, 53, 0.2) 100%);
        border: 1px solid rgba(255, 154, 86, 0.3);
    }

    .muscle-name {
        font-size: 15px;
        color: #e0e0e0;
        font-weight: 500;
        flex: 1;
    }

    .muscle-counter {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .muscle-btn {
        width: 32px;
        height: 32px;
        background: #1a1a1a;
        border: 2px solid #444;
        border-radius: 8px;
        color: #ff9a56;
        font-size: 20px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        user-select: none;
    }

    .muscle-btn:active {
        transform: scale(0.9);
        background: #222;
    }

    .muscle-btn.active {
        background: linear-gradient(135deg, #ff9a56 0%, #ff6b35 100%);
        border-color: #ff6b35;
        color: white;
    }

    .muscle-count {
        min-width: 30px;
        text-align: center;
        font-size: 18px;
        font-weight: 700;
        color: #ff9a56;
    }

    .muscle-reset {
        width: 28px;
        height: 28px;
        background: transparent;
        border: none;
        color: #666;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .muscle-reset:active {
        transform: scale(0.9);
        color: #ff6b35;
    }

    .muscle-delete {
        width: 28px;
        height: 28px;
        background: transparent;
        border: none;
        color: #999;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-left: 5px;
    }

    .muscle-delete:active {
        transform: scale(0.9);
        color: #ff3535;
    }

    .add-category-btn {
        background: linear-gradient(135deg, #ff9a56 0%, #ff6b35 100%);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        margin: 10px 0;
        width: 100%;
        transition: all 0.3s;
    }

    .add-category-btn:active {
        transform: scale(0.98);
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: #2a2a2a;
        border-radius: 20px;
        padding: 25px;
        max-width: 400px;
        width: 100%;
        border: 1px solid rgba(255, 154, 86, 0.3);
    }

    .modal-title {
        font-size: 20px;
        font-weight: 700;
        color: #ff9a56;
        margin-bottom: 20px;
        text-align: center;
    }

    .modal-input {
        width: 100%;
        background: #1a1a1a;
        border: 2px solid #444;
        border-radius: 12px;
        padding: 12px 15px;
        color: #e0e0e0;
        font-size: 16px;
        margin-bottom: 15px;
        outline: none;
    }

    .modal-input:focus {
        border-color: #ff9a56;
    }

    .modal-buttons {
        display: flex;
        gap: 10px;
    }

    .modal-btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .modal-btn.primary {
        background: linear-gradient(135deg, #ff9a56 0%, #ff6b35 100%);
        color: white;
    }

    .modal-btn.secondary {
        background: #1a1a1a;
        color: #999;
        border: 2px solid #444;
    }

    .modal-btn:active {
        transform: scale(0.98);
    }

    @media (max-width: 380px) {
        .days-grid {
            gap: 4px;
        }
        
        .day-checkbox {
            width: 18px;
            height: 18px;
        }
    }

    /* –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è –≤–µ—Ä—Å–∏—è - –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ */
    @media (min-width: 768px) {
        .container {
            max-width: 1400px;
            padding: 20px;
        }

        .header {
            margin-bottom: 20px;
        }

        .tasks-grid {
            padding: 20px;
        }

        #tasksGrid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .task-category {
            margin-bottom: 0;
        }

        .category-header {
            font-size: 14px;
            padding: 10px 12px;
        }

        .category-name {
            font-size: 14px;
        }

        .category-count {
            font-size: 12px;
            padding: 3px 10px;
        }

        .week-header {
            font-size: 11px;
        }

        .week-container {
            margin-bottom: 10px;
        }

        .days-grid {
            gap: 4px;
        }

        .day-cell {
            padding: 2px;
        }

        .day-label {
            font-size: 9px;
        }

        .day-checkbox {
            width: 16px;
            height: 16px;
        }

        .day-checkbox:checked::after {
            font-size: 12px;
        }

        /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
        .tabs {
            max-width: 600px;
            margin: 0 auto 20px;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
        .stats-container {
            max-width: 1200px;
            margin: 0 auto 20px;
        }

        .muscle-tracker {
            max-width: 600px;
            margin: 0 auto;
        }

        /* –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
        .add-category-btn {
            margin: 10px 0;
            grid-column: 1 / -1;
        }

        /* –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –¥–µ–ª–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        .task-category {
            margin-bottom: 0;
        }
    }

    /* –î–ª—è –æ—á–µ–Ω—å —à–∏—Ä–æ–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ - –µ—â–µ –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
    @media (min-width: 1200px) {
        #tasksGrid {
            grid-template-columns: repeat(3, 1fr);
        }

        .category-header {
            font-size: 13px;
            padding: 8px 10px;
        }

        .day-label {
            font-size: 8px;
        }

        .day-checkbox {
            width: 14px;
            height: 14px;
        }
    }
</style>

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–¢—Ä–µ–∫–µ—Ä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏</h1>
            <div class="month-selector">
                <button class="month-btn" onclick="changeMonth(-1)">‚Üê</button>
                <div class="current-month" id="currentMonth"></div>
                <button class="month-btn" onclick="changeMonth(1)">‚Üí</button>
            </div>
        </div>

    <div class="tabs">
        <button class="tab active" onclick="switchTab('tasks')">–ó–∞–¥–∞—á–∏</button>
        <button class="tab" onclick="switchTab('program')">–ü—Ä–æ–≥—Ä–∞–º–º–∞</button>
        <button class="tab" onclick="switchTab('month')">–ú–µ—Å—è—Ü</button>
        <button class="tab" onclick="switchTab('year')">–ì–æ–¥</button>
    </div>

    <div id="tasksSection" class="content-section active">
        <div class="tasks-grid">
            <button class="add-category-btn" onclick="openAddCategoryModal()">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
            <div id="tasksGrid"></div>
        </div>
    </div>

    <div id="programSection" class="content-section">
        <div class="muscle-tracker">
            <h2 class="chart-title">–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
            <button class="add-category-btn" onclick="openAddExerciseModal()">+ –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
            <div class="muscle-grid" id="muscleGrid"></div>
        </div>
    </div>

    <div id="monthSection" class="content-section">
        <div class="stats-container">
            <h2 class="chart-title">–ò—Ç–æ–≥–∏ –º–µ—Å—è—Ü–∞</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                    <div class="stat-value" id="monthTotal">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                    <div class="stat-value" id="monthCompleted">0</div>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</div>
                <div class="bar-chart" id="monthChart"></div>
            </div>
        </div>
    </div>

    <div id="yearSection" class="content-section">
        <div class="stats-container">
            <h2 class="chart-title">–ò—Ç–æ–≥–∏ –≥–æ–¥–∞</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                    <div class="stat-value" id="yearTotal">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                    <div class="stat-value" id="yearCompleted">0</div>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</div>
                <div class="summary-list" id="yearSummary"></div>
            </div>
        </div>
    </div>
</div>

<div id="addCategoryModal" class="modal">
    <div class="modal-content">
        <div class="modal-title">–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</div>
        <input type="text" id="newCategoryInput" class="modal-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" maxlength="20">
        <div class="modal-buttons">
            <button class="modal-btn secondary" onclick="closeAddCategoryModal()">–û—Ç–º–µ–Ω–∞</button>
            <button class="modal-btn primary" onclick="addNewCategory()">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
    </div>
</div>

<div id="addExerciseModal" class="modal">
    <div class="modal-content">
        <div class="modal-title">–ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</div>
        <input type="text" id="newExerciseInput" class="modal-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è" maxlength="30">
        <div class="modal-buttons">
            <button class="modal-btn secondary" onclick="closeAddExerciseModal()">–û—Ç–º–µ–Ω–∞</button>
            <button class="modal-btn primary" onclick="addNewExercise()">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
    </div>
</div>

<script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBDr6IVKewAVwv7FqxChVRv5pylnsHTdTw",
        authDomain: "todo-8e256.firebaseapp.com",
        databaseURL: "https://todo-8e256-default-rtdb.firebaseio.com",
        projectId: "todo-8e256",
        storageBucket: "todo-8e256.firebasestorage.app",
        messagingSenderId: "659322901199",
        appId: "1:659322901199:web:a7819a4878706567e55dba",
        measurementId: "G-491KYXN5K2"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    let database = null;
    let isFirebaseEnabled = false;

    try {
        firebase.initializeApp(firebaseConfig);
        database = firebase.database();
        isFirebaseEnabled = true;
        console.log('Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω');
    } catch (error) {
        console.log('Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è localStorage:', error);
        isFirebaseEnabled = false;
    }

    let currentDate = new Date();
    let tasks = {};
    let muscles = {};
    let collapsedCategories = {};
    let categories = [];
    let exerciseList = [];

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∑–∞–¥–∞—á
    function loadCategories() {
        const saved = localStorage.getItem('categories');
        return saved ? JSON.parse(saved) : [
            '–°–ø–æ—Ä—Ç',
            '–°—Ç—É–¥–∏—è',
            '–î–Ω–µ–≤–Ω–∏–∫',
            '–í—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è',
            '–ö–æ–Ω—Ç–µ–Ω—Ç',
            '–†–µ–ª–∏–∑—ã'
        ];
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
    function loadExerciseList() {
        const saved = localStorage.getItem('exerciseList');
        return saved ? JSON.parse(saved) : [
            '–ü–ª–µ—á–∏',
            '–¢—Ä–∏—Ü–µ–ø—Å',
            '–ë–∏—Ü–µ–ø—Å',
            '–û—Ç–∂–∏–º–∞–Ω–∏—è',
            '–ü—Ä–µ—Å—Å',
            '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è',
            '–ù–æ–≥–∏'
        ];
    }

    function saveCategories() {
        localStorage.setItem('categories', JSON.stringify(categories));
        if (isFirebaseEnabled) {
            database.ref('categories').set(categories);
        }
    }

    function saveExerciseList() {
        localStorage.setItem('exerciseList', JSON.stringify(exerciseList));
        if (isFirebaseEnabled) {
            database.ref('exerciseList').set(exerciseList);
        }
    }

    async function loadData() {
        if (isFirebaseEnabled) {
            try {
                const tasksSnapshot = await database.ref('tasks').once('value');
                const musclesSnapshot = await database.ref('muscles').once('value');
                const categoriesSnapshot = await database.ref('categories').once('value');
                const exerciseListSnapshot = await database.ref('exerciseList').once('value');
                
                tasks = tasksSnapshot.val() || {};
                muscles = musclesSnapshot.val() || {};
                if (categoriesSnapshot.val()) {
                    categories = categoriesSnapshot.val();
                } else {
                    categories = loadCategories();
                }
                if (exerciseListSnapshot.val()) {
                    exerciseList = exerciseListSnapshot.val();
                } else {
                    exerciseList = loadExerciseList();
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Firebase:', error);
                loadFromLocalStorage();
            }
        } else {
            loadFromLocalStorage();
        }
    }

    function loadFromLocalStorage() {
        const savedTasks = localStorage.getItem('taskTracker');
        const savedMuscles = localStorage.getItem('muscleTracker');
        const savedCollapsed = localStorage.getItem('collapsedCategories');
        
        tasks = savedTasks ? JSON.parse(savedTasks) : {};
        muscles = savedMuscles ? JSON.parse(savedMuscles) : {};
        collapsedCategories = savedCollapsed ? JSON.parse(savedCollapsed) : {};
        categories = loadCategories();
        exerciseList = loadExerciseList();
    }

    function saveTasks() {
        localStorage.setItem('taskTracker', JSON.stringify(tasks));
        if (isFirebaseEnabled) {
            database.ref('tasks').set(tasks);
        }
    }

    function saveMuscles() {
        localStorage.setItem('muscleTracker', JSON.stringify(muscles));
        if (isFirebaseEnabled) {
            database.ref('muscles').set(muscles);
        }
    }

    function saveCollapsedState() {
        localStorage.setItem('collapsedCategories', JSON.stringify(collapsedCategories));
    }

    function getTaskKey(year, month, day, category) {
        return `${year}-${month}-${day}-${category}`;
    }

    function getMuscleKey(year, month, muscle) {
        return `${year}-${month}-${muscle}`;
    }

    function toggleCategory(category) {
        const key = `${currentDate.getFullYear()}-${currentDate.getMonth()}-${category}`;
        collapsedCategories[key] = !collapsedCategories[key];
        saveCollapsedState();
        updateDisplay();
    }

    function openAddCategoryModal() {
        document.getElementById('addCategoryModal').classList.add('active');
        document.getElementById('newCategoryInput').value = '';
        document.getElementById('newCategoryInput').focus();
    }

    function closeAddCategoryModal() {
        document.getElementById('addCategoryModal').classList.remove('active');
    }

    function addNewCategory() {
        const input = document.getElementById('newCategoryInput');
        const newCategory = input.value.trim();
        
        if (newCategory && !categories.includes(newCategory)) {
            categories.push(newCategory);
            saveCategories();
            closeAddCategoryModal();
            updateDisplay();
        } else if (categories.includes(newCategory)) {
            alert('–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
        } else {
            alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!');
        }
    }

    function openAddExerciseModal() {
        document.getElementById('addExerciseModal').classList.add('active');
        document.getElementById('newExerciseInput').value = '';
        document.getElementById('newExerciseInput').focus();
    }

    function closeAddExerciseModal() {
        document.getElementById('addExerciseModal').classList.remove('active');
    }

    function addNewExercise() {
        const input = document.getElementById('newExerciseInput');
        const newExercise = input.value.trim();
        
        if (newExercise && !exerciseList.includes(newExercise)) {
            exerciseList.push(newExercise);
            saveExerciseList();
            closeAddExerciseModal();
            renderMuscleTracker();
        } else if (exerciseList.includes(newExercise)) {
            alert('–¢–∞–∫–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
        } else {
            alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è!');
        }
    }

    function deleteExercise(exercise) {
        if (confirm(`–£–¥–∞–ª–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ "${exercise}"? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —ç—Ç–æ–º—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.`)) {
            exerciseList = exerciseList.filter(ex => ex !== exercise);
            saveExerciseList();
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —ç—Ç–æ–º—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const key = getMuscleKey(year, month, exercise);
            delete muscles[key];
            saveMuscles();
            
            renderMuscleTracker();
        }
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
    document.addEventListener('click', function(e) {
        const categoryModal = document.getElementById('addCategoryModal');
        const exerciseModal = document.getElementById('addExerciseModal');
        
        if (e.target === categoryModal) {
            closeAddCategoryModal();
        }
        if (e.target === exerciseModal) {
            closeAddExerciseModal();
        }
    });

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ Enter
    document.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            if (document.getElementById('addCategoryModal').classList.contains('active')) {
                addNewCategory();
            }
            if (document.getElementById('addExerciseModal').classList.contains('active')) {
                addNewExercise();
            }
        }
    });

    function changeMonth(delta) {
        currentDate.setMonth(currentDate.getMonth() + delta);
        updateDisplay();
    }

    function switchTab(tab) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById(tab + 'Section').classList.add('active');
        
        if (tab === 'program') renderMuscleTracker();
        if (tab === 'month') updateMonthStats();
        if (tab === 'year') updateYearStats();
    }

    function updateDisplay() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', 
                          '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
        
        document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
        
        renderTasks(year, month);
    }

    function renderTasks(year, month) {
        const grid = document.getElementById('tasksGrid');
        grid.innerHTML = '';
        
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const firstDay = new Date(year, month, 1).getDay();
        const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —à–∏—Ä–∏–Ω—É —ç–∫—Ä–∞–Ω–∞
        const isDesktop = window.innerWidth >= 768;
        
        categories.forEach(category => {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'task-category';
            
            const completed = getCompletedCount(year, month, category);
            const collapseKey = `${year}-${month}-${category}`;
            
            // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ, –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º - —Å–≤—ë—Ä–Ω—É—Ç–æ
            let isCollapsed;
            if (collapsedCategories.hasOwnProperty(collapseKey)) {
                isCollapsed = collapsedCategories[collapseKey];
            } else {
                isCollapsed = !isDesktop;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
            const counterDisplay = isCollapsed 
                ? `<span class="category-count">${completed}</span>`
                : `<span class="category-count">${completed}/${daysInMonth}</span>`;
            
            categoryDiv.innerHTML = `
                <div class="category-header" onclick="toggleCategory('${category}')">
                    <span class="category-name">${category}</span>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        ${counterDisplay}
                        <span class="category-toggle ${isCollapsed ? 'collapsed' : ''}">‚ñº</span>
                    </div>
                </div>
            `;
            
            let weekHtml = '';
            let currentWeekDays = [];
            let weekNumber = 1;
            
            for (let i = 0; i < adjustedFirstDay; i++) {
                currentWeekDays.push('<div class="day-cell" style="opacity: 0.3;"></div>');
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const key = getTaskKey(year, month, day, category);
                const isChecked = tasks[key] || false;
                const dayName = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'][(adjustedFirstDay + day - 1) % 7];
                
                currentWeekDays.push(`
                    <div class="day-cell">
                        <div class="day-label">${dayName}</div>
                        <input type="checkbox" 
                               class="day-checkbox" 
                               ${isChecked ? 'checked' : ''}
                               onchange="toggleTask(${year}, ${month}, ${day}, '${category}')">
                    </div>
                `);
                
                if ((adjustedFirstDay + day) % 7 === 0 || day === daysInMonth) {
                    while (currentWeekDays.length < 7) {
                        currentWeekDays.push('<div class="day-cell" style="opacity: 0.3;"></div>');
                    }
                    
                    weekHtml += `
                        <div class="week-container">
                            <div class="week-header">–ù–µ–¥–µ–ª—è ${weekNumber}</div>
                            <div class="days-grid">${currentWeekDays.join('')}</div>
                        </div>
                    `;
                    currentWeekDays = [];
                    weekNumber++;
                }
            }
            
            categoryDiv.innerHTML += `<div class="category-content ${isCollapsed ? 'collapsed' : ''}">${weekHtml}</div>`;
            grid.appendChild(categoryDiv);
        });
    }

    function toggleTask(year, month, day, category) {
        const key = getTaskKey(year, month, day, category);
        tasks[key] = !tasks[key];
        saveTasks();
        updateDisplay();
    }

    function incrementMuscle(year, month, muscle) {
        const key = getMuscleKey(year, month, muscle);
        muscles[key] = (muscles[key] || 0) + 1;
        saveMuscles();
        renderMuscleTracker();
    }

    function decrementMuscle(year, month, muscle) {
        const key = getMuscleKey(year, month, muscle);
        if (muscles[key] && muscles[key] > 0) {
            muscles[key] = muscles[key] - 1;
            if (muscles[key] === 0) {
                delete muscles[key];
            }
            saveMuscles();
            renderMuscleTracker();
        }
    }

    function resetMuscle(year, month, muscle) {
        const key = getMuscleKey(year, month, muscle);
        delete muscles[key];
        saveMuscles();
        renderMuscleTracker();
    }

    function renderMuscleTracker() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const grid = document.getElementById('muscleGrid');
        
        grid.innerHTML = exerciseList.map(muscle => {
            const key = getMuscleKey(year, month, muscle);
            const count = muscles[key] || 0;
            const hasValue = count > 0;
            
            return `
                <div class="muscle-item ${hasValue ? 'completed' : ''}">
                    <span class="muscle-name">${muscle}</span>
                    <div class="muscle-counter">
                        ${hasValue ? `<div class="muscle-btn active" onclick="decrementMuscle(${year}, ${month}, '${muscle}')">‚àí</div>` : '<div style="width: 32px;"></div>'}
                        <div class="muscle-count">${count > 0 ? count : ''}</div>
                        <div class="muscle-btn ${hasValue ? 'active' : ''}" 
                             onclick="incrementMuscle(${year}, ${month}, '${muscle}')">+</div>
                        ${count > 0 ? `<div class="muscle-reset" onclick="resetMuscle(${year}, ${month}, '${muscle}')">√ó</div>` : '<div style="width: 28px;"></div>'}
                        <div class="muscle-delete" onclick="deleteExercise('${muscle}')">üóë</div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function getCompletedCount(year, month, category) {
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        let count = 0;
        for (let day = 1; day <= daysInMonth; day++) {
            const key = getTaskKey(year, month, day, category);
            if (tasks[key]) count++;
        }
        return count;
    }

    function updateMonthStats() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        let total = 0;
        let completed = 0;
        const categoryStats = {};
        
        categories.forEach(cat => categoryStats[cat] = { total: 0, completed: 0 });
        
        for (let day = 1; day <= daysInMonth; day++) {
            categories.forEach(category => {
                const key = getTaskKey(year, month, day, category);
                categoryStats[category].total++;
                total++;
                if (tasks[key]) {
                    categoryStats[category].completed++;
                    completed++;
                }
            });
        }
        
        document.getElementById('monthTotal').textContent = total;
        document.getElementById('monthCompleted').textContent = completed;
        
        const chartHtml = categories.map(cat => {
            const percent = categoryStats[cat].total > 0 
                ? (categoryStats[cat].completed / categoryStats[cat].total * 100).toFixed(0)
                : 0;
            return `
                <div class="bar-item">
                    <div class="bar-label">${cat}</div>
                    <div class="bar-track">
                        <div class="bar-fill" style="width: ${percent}%">${categoryStats[cat].completed}/${categoryStats[cat].total}</div>
                    </div>
                </div>
            `;
        }).join('');
        
        document.getElementById('monthChart').innerHTML = chartHtml;
    }

    function updateYearStats() {
        const year = currentDate.getFullYear();
        
        let totalYear = 0;
        let completedYear = 0;
        const monthlyStats = [];
        
        const monthNames = ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–ò—é–Ω', 
                          '–ò—é–ª', '–ê–≤–≥', '–°–µ–Ω', '–û–∫—Ç', '–ù–æ—è', '–î–µ–∫'];
        
        for (let month = 0; month < 12; month++) {
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            let monthTotal = 0;
            let monthCompleted = 0;
            
            for (let day = 1; day <= daysInMonth; day++) {
                categories.forEach(category => {
                    const key = getTaskKey(year, month, day, category);
                    monthTotal++;
                    totalYear++;
                    if (tasks[key]) {
                        monthCompleted++;
                        completedYear++;
                    }
                });
            }
            
            const percent = monthTotal > 0 ? (monthCompleted / monthTotal * 100).toFixed(0) : 0;
            monthlyStats.push({ name: monthNames[month], completed: monthCompleted, total: monthTotal, percent });
        }
        
        document.getElementById('yearTotal').textContent = totalYear;
        document.getElementById('yearCompleted').textContent = completedYear;
        
        const summaryHtml = monthlyStats.map(m => `
            <div class="summary-item">
                <div class="summary-category">${m.name}</div>
                <div class="summary-stats">
                    <div class="summary-stat">
                        <div class="summary-stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                        <div class="summary-stat-value">${m.completed}/${m.total}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç</div>
                        <div class="summary-stat-value">${m.percent}%</div>
                    </div>
                </div>
            </div>
        `).join('');
        
        document.getElementById('yearSummary').innerHTML = summaryHtml;
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    async function initApp() {
        await loadData();
        updateDisplay();
    }

    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ (–¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –¥–µ—Å–∫—Ç–æ–ø/–º–æ–±–∏–ª—å–Ω—ã–π)
    window.addEventListener('resize', function() {
        updateDisplay();
    });

    initApp();
</script>

</body>
</html>